# 禁发中文功能测试指南

## 快速测试步骤

### 1. 启用功能
1. 打开 WhatsApp 翻译应用
2. 点击左下角设置按钮
3. 在"高级设置"中勾选"禁发中文"
4. 保存设置

### 2. 基础测试

#### 测试 1：Enter 键发送
1. 在输入框输入中文："你好"
2. 按 Enter 键
3. **预期**：
   - ❌ 消息不会发送
   - ✅ 显示黄色提示框："检测到中文内容"
   - ✅ 发送按钮变灰（透明度 0.5）

#### 测试 2：点击发送按钮
1. 在输入框输入中文："测试"
2. 点击发送按钮
3. **预期**：
   - ❌ 消息不会发送
   - ✅ 显示提示框
   - ✅ 按钮保持禁用状态

#### 测试 3：快速连续操作
1. 输入中文："快速测试"
2. 快速按多次 Enter 键
3. **预期**：
   - ❌ 所有尝试都被拦截
   - ✅ 只显示一次提示（防止重复）

#### 测试 4：删除中文后恢复
1. 输入中文："测试"
2. 观察发送按钮变灰
3. 删除所有中文
4. 输入英文："test"
5. **预期**：
   - ✅ 发送按钮恢复正常
   - ✅ 可以正常发送英文

### 3. 高级测试

#### 测试 5：混合内容
1. 输入："Hello 你好 World"
2. 尝试发送
3. **预期**：
   - ❌ 被拦截（包含中文）

#### 测试 6：联系人独立配置
1. 启用"好友独立翻译"
2. 为某个联系人单独启用"禁发中文"
3. 切换到该联系人
4. 输入中文测试
5. **预期**：
   - ✅ 该联系人被拦截
6. 切换到其他联系人
7. **预期**：
   - ✅ 其他联系人可以发送中文（如果全局未启用）

#### 测试 7：配置切换
1. 启用"禁发中文"
2. 输入中文，确认被拦截
3. 打开设置，关闭"禁发中文"
4. 保存设置
5. 再次输入中文
6. **预期**：
   - ✅ 可以正常发送

### 4. 边界测试

#### 测试 8：空消息
1. 不输入任何内容
2. 尝试发送
3. **预期**：
   - ✅ 正常行为（WhatsApp 自己会阻止）

#### 测试 9：只有空格
1. 输入多个空格
2. 尝试发送
3. **预期**：
   - ✅ 正常行为

#### 测试 10：表情符号
1. 输入："😀 测试 🎉"
2. 尝试发送
3. **预期**：
   - ❌ 被拦截（包含中文）

#### 测试 11：多行文本
1. 输入：
   ```
   第一行
   第二行
   第三行
   ```
2. 尝试发送
3. **预期**：
   - ❌ 被拦截

## 性能测试

### 测试 12：响应速度
1. 输入中文
2. 观察发送按钮变灰的速度
3. **预期**：
   - ✅ 100ms 内变灰（几乎即时）

### 测试 13：CPU 占用
1. 打开任务管理器
2. 启用禁发中文功能
3. 观察 CPU 占用
4. **预期**：
   - ✅ 几乎无影响（<1% CPU）

## 调试信息

### 查看日志
1. 按 F12 打开开发者工具
2. 切换到 Console 标签
3. 输入中文并尝试发送
4. 查看日志输出：
   ```
   [Translation] Setting up Chinese blocking with multi-layer defense
   [Translation] Chinese blocking enabled with 5-layer defense
   [Translation] Blocked Chinese message send via Enter key
   [Translation] Blocked Chinese message send via mousedown on send button
   ```

### 检查按钮状态
1. 输入中文
2. 在开发者工具中选择发送按钮
3. 查看样式：
   ```css
   pointer-events: none;
   opacity: 0.5;
   ```
4. 查看属性：
   ```html
   data-chinese-blocked="true"
   ```

## 常见问题

### Q1: 第一次拦截成功，第二次失败？
**A**: 这是旧版本的问题，新版本使用5层防御机制，应该不会出现。如果还有问题，请查看控制台日志。

### Q2: 按钮没有变灰？
**A**: 检查：
1. 是否启用了"禁发中文"
2. 输入框是否真的包含中文
3. 查看控制台是否有错误

### Q3: 删除中文后按钮还是灰的？
**A**: 等待最多 100ms，监控会自动恢复按钮状态。

### Q4: 影响正常使用？
**A**: 如果遇到问题，可以：
1. 关闭"禁发中文"功能
2. 或者为特定联系人禁用

## 成功标准

所有测试通过的标准：
- ✅ 所有包含中文的消息都被拦截
- ✅ 显示清晰的提示信息
- ✅ 发送按钮实时反馈（变灰/恢复）
- ✅ 配置切换立即生效
- ✅ 不影响正常的英文/其他语言发送
- ✅ 性能开销可忽略

## 报告问题

如果发现问题，请提供：
1. 具体的测试步骤
2. 预期结果 vs 实际结果
3. 控制台日志截图
4. 浏览器和 WhatsApp Web 版本
