# è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

WhatsApp Web ç¿»è¯‘ç³»ç»Ÿæ˜¯ä¸€ä¸ªé›†æˆåœ¨æ¡Œé¢å®¢æˆ·ç«¯ä¸­çš„å…¨åŠŸèƒ½ç¿»è¯‘è§£å†³æ–¹æ¡ˆã€‚è¯¥ç³»ç»ŸåŸºäº Electron + whatsapp-web.js æ¶æ„ï¼Œé€šè¿‡å†…å®¹è„šæœ¬æ³¨å…¥å’Œæ¶ˆæ¯æ‹¦æˆªå®ç°å¯¹ WhatsApp Web ç•Œé¢çš„ç¿»è¯‘å¢å¼ºã€‚ç³»ç»Ÿæ”¯æŒå¤šç§ç¿»è¯‘å¼•æ“ï¼ˆGoogleç¿»è¯‘ã€GPT-4ã€Geminiã€DeepSeekã€è‡ªå®šä¹‰AI APIï¼‰ï¼Œæä¾›æ¶ˆæ¯æ¥æ”¶ç¿»è¯‘ã€è¾“å…¥æ¡†å‘é€ç¿»è¯‘ã€è¯­éŸ³ç¿»è¯‘ã€å›¾ç‰‡OCRç¿»è¯‘ç­‰åŠŸèƒ½ã€‚

## æ¶æ„

### ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Electron ä¸»è¿›ç¨‹                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚           ç¿»è¯‘æœåŠ¡ç®¡ç†å™¨ (TranslationManager)         â”‚  â”‚
â”‚  â”‚  - ç¿»è¯‘å¼•æ“æ³¨å†Œä¸ç®¡ç†                                 â”‚  â”‚
â”‚  â”‚  - é…ç½®æŒä¹…åŒ–                                         â”‚  â”‚
â”‚  â”‚  - IPC é€šä¿¡å¤„ç†                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ç¿»è¯‘å¼•æ“é€‚é…å™¨ (Translation Adapters)         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚  â”‚
â”‚  â”‚  â”‚  Google  â”‚ â”‚   GPT-4  â”‚ â”‚  Gemini  â”‚  ...        â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚            ç¼“å­˜ç®¡ç†å™¨ (CacheManager)                  â”‚  â”‚
â”‚  â”‚  - LRU ç¼“å­˜ç­–ç•¥                                       â”‚  â”‚
â”‚  â”‚  - æŒä¹…åŒ–å­˜å‚¨                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚ IPC
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Electron æ¸²æŸ“è¿›ç¨‹ (WhatsApp Web)            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         å†…å®¹è„šæœ¬ (Content Script Injector)            â”‚  â”‚
â”‚  â”‚  - DOM ç›‘å¬ä¸æ“ä½œ                                     â”‚  â”‚
â”‚  â”‚  - æ¶ˆæ¯æ‹¦æˆªä¸æ³¨å…¥                                     â”‚  â”‚
â”‚  â”‚  - UI ç»„ä»¶æ¸²æŸ“                                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚         ç¿»è¯‘ UI æ§åˆ¶å™¨ (TranslationUIController)      â”‚  â”‚
â”‚  â”‚  - ç¿»è¯‘æŒ‰é’®æ¸²æŸ“                                       â”‚  â”‚
â”‚  â”‚  - ç¿»è¯‘ç»“æœæ˜¾ç¤º                                       â”‚  â”‚
â”‚  â”‚  - è®¾ç½®é¢æ¿ç®¡ç†                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚      æ¶ˆæ¯å¤„ç†å™¨ (MessageProcessor)                    â”‚  â”‚
â”‚  â”‚  - æ¶ˆæ¯ç›‘å¬                                           â”‚  â”‚
â”‚  â”‚  - è¯­è¨€æ£€æµ‹                                           â”‚  â”‚
â”‚  â”‚  - ç¿»è¯‘è§¦å‘                                           â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æŠ€æœ¯æ ˆ

- **å‰ç«¯æ¡†æ¶**: Electron 39.x
- **WhatsApp é›†æˆ**: whatsapp-web.js 1.23.x
- **å†…å®¹è„šæœ¬æ³¨å…¥**: Electron webContents.executeJavaScript
- **è¿›ç¨‹é€šä¿¡**: Electron IPC (ipcMain/ipcRenderer)
- **ç¿»è¯‘å¼•æ“**: 
  - Google Translate API
  - OpenAI GPT-4 API
  - Google Gemini API
  - DeepSeek API
  - è‡ªå®šä¹‰ AI API (å…¼å®¹ OpenAI æ ¼å¼)
- **è¯­éŸ³è¯†åˆ«**: Web Speech API / OpenAI Whisper API
- **OCR**: Tesseract.js / Google Cloud Vision API
- **ç¼“å­˜**: LRU Cache + SQLite
- **é…ç½®å­˜å‚¨**: electron-store


## ç»„ä»¶å’Œæ¥å£

### 1. ç¿»è¯‘æœåŠ¡ç®¡ç†å™¨ (TranslationManager)

ä¸»è¿›ç¨‹ä¸­çš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†æ‰€æœ‰ç¿»è¯‘ç›¸å…³çš„æœåŠ¡å’Œé…ç½®ã€‚

```javascript
class TranslationManager {
  constructor() {
    this.engines = new Map();
    this.config = null;
    this.cache = null;
  }

  // æ³¨å†Œç¿»è¯‘å¼•æ“
  registerEngine(name, adapter) {}

  // æ‰§è¡Œç¿»è¯‘
  async translate(text, sourceLang, targetLang, engineName, options) {}

  // è·å–é…ç½®
  getConfig(accountId) {}

  // ä¿å­˜é…ç½®
  saveConfig(accountId, config) {}

  // è¯­è¨€æ£€æµ‹
  async detectLanguage(text) {}
}
```

**æ¥å£å®šä¹‰**:

```typescript
interface TranslationRequest {
  text: string;
  sourceLang: string;  // 'auto' for auto-detect
  targetLang: string;
  engineName: string;
  style?: string;      // AI ç¿»è¯‘é£æ ¼
  context?: string;    // ä¸Šä¸‹æ–‡ä¿¡æ¯
}

interface TranslationResponse {
  translatedText: string;
  detectedLang?: string;
  confidence?: number;
  cached: boolean;
  engineUsed: string;
}

interface TranslationConfig {
  accountId: string;
  global: {
    autoTranslate: boolean;
    engine: string;
    sourceLang: string;
    targetLang: string;
    groupTranslation: boolean;
  };
  inputBox: {
    enabled: boolean;
    style: string;
  };
  advanced: {
    friendIndependent: boolean;
    blockChinese: boolean;
    realtime: boolean;
    reverseTranslation: boolean;
    voiceTranslation: boolean;
    imageTranslation: boolean;
  };
  friendConfigs: Map<string, FriendTranslationConfig>;
}

interface FriendTranslationConfig {
  contactId: string;
  enabled: boolean;
  targetLang: string;
  blockChinese: boolean;
}
```

### 2. ç¿»è¯‘å¼•æ“é€‚é…å™¨ (Translation Adapters)

ç»Ÿä¸€çš„ç¿»è¯‘å¼•æ“æ¥å£ï¼Œæ”¯æŒå¤šç§ç¿»è¯‘æœåŠ¡ã€‚

```javascript
// åŸºç¡€é€‚é…å™¨æ¥å£
class TranslationAdapter {
  constructor(config) {
    this.config = config;
  }

  async translate(text, sourceLang, targetLang, options) {
    throw new Error('Must implement translate method');
  }

  async detectLanguage(text) {
    throw new Error('Must implement detectLanguage method');
  }

  isAvailable() {
    return true;
  }
}

// Google ç¿»è¯‘é€‚é…å™¨
class GoogleTranslateAdapter extends TranslationAdapter {
  async translate(text, sourceLang, targetLang, options) {
    // ä½¿ç”¨ Google Translate API
  }
}

// AI ç¿»è¯‘é€‚é…å™¨ (GPT-4, Gemini, DeepSeek)
class AITranslationAdapter extends TranslationAdapter {
  constructor(config) {
    super(config);
    this.apiEndpoint = config.endpoint;
    this.apiKey = config.apiKey;
    this.model = config.model;
  }

  async translate(text, sourceLang, targetLang, options) {
    const style = options.style || 'é€šç”¨';
    const prompt = this.buildPrompt(text, sourceLang, targetLang, style);
    // è°ƒç”¨ AI API
  }

  buildPrompt(text, sourceLang, targetLang, style) {
    const stylePrompts = {
      'é€šç”¨': 'è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ{targetLang}ï¼Œä¿æŒåŸæ„ã€‚',
      'æ­£å¼': 'è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ{targetLang}ï¼Œä½¿ç”¨æ­£å¼ã€ä¸“ä¸šçš„è¯­æ°”ã€‚',
      'å£è¯­åŒ–': 'è¯·å°†ä»¥ä¸‹æ–‡æœ¬ç¿»è¯‘æˆ{targetLang}ï¼Œä½¿ç”¨å£è¯­åŒ–ã€è½»æ¾çš„è¡¨è¾¾ã€‚',
      // ... å…¶ä»–é£æ ¼
    };
    return `${stylePrompts[style]}\n\nåŸæ–‡ï¼š${text}\n\nåªè¾“å‡ºç¿»è¯‘ç»“æœï¼Œä¸è¦åŒ…å«ä»»ä½•è§£é‡Šæˆ–é¢å¤–å†…å®¹ã€‚`;
  }
}
```

### 3. ç¼“å­˜ç®¡ç†å™¨ (CacheManager)

ç®¡ç†ç¿»è¯‘ç»“æœçš„ç¼“å­˜ï¼Œæé«˜æ€§èƒ½å¹¶å‡å°‘ API è°ƒç”¨ã€‚

```javascript
class CacheManager {
  constructor(maxSize = 1000, ttl = 7 * 24 * 60 * 60 * 1000) {
    this.cache = new LRUCache({ max: maxSize });
    this.ttl = ttl;
    this.db = null; // SQLite æ•°æ®åº“
  }

  // ç”Ÿæˆç¼“å­˜é”®
  generateKey(text, sourceLang, targetLang, engine) {
    return crypto.createHash('md5')
      .update(`${text}:${sourceLang}:${targetLang}:${engine}`)
      .digest('hex');
  }

  // è·å–ç¼“å­˜
  async get(text, sourceLang, targetLang, engine) {}

  // è®¾ç½®ç¼“å­˜
  async set(text, sourceLang, targetLang, engine, result) {}

  // æ¸…ç†è¿‡æœŸç¼“å­˜
  async cleanup() {}

  // è·å–ç»Ÿè®¡ä¿¡æ¯
  getStats() {}
}
```


### 4. å†…å®¹è„šæœ¬æ³¨å…¥å™¨ (Content Script Injector)

åœ¨ WhatsApp Web é¡µé¢ä¸­æ³¨å…¥è„šæœ¬ï¼Œå®ç° DOM æ“ä½œå’Œæ¶ˆæ¯æ‹¦æˆªã€‚

```javascript
// åœ¨ä¸»è¿›ç¨‹ä¸­æ³¨å…¥
function injectTranslationScript(webContents) {
  webContents.executeJavaScript(`
    (function() {
      // ç¿»è¯‘ç³»ç»Ÿåˆå§‹åŒ–
      window.WhatsAppTranslation = {
        config: null,
        messageObserver: null,
        inputObserver: null,
        
        init: function() {
          this.observeMessages();
          this.observeInputBox();
          this.injectUI();
        },
        
        observeMessages: function() {
          // ç›‘å¬æ¶ˆæ¯ DOM å˜åŒ–
          const chatContainer = document.querySelector('[data-testid="conversation-panel-messages"]');
          if (!chatContainer) return;
          
          this.messageObserver = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
              mutation.addedNodes.forEach((node) => {
                if (node.nodeType === 1 && node.matches('[data-testid="msg-container"]')) {
                  this.handleNewMessage(node);
                }
              });
            });
          });
          
          this.messageObserver.observe(chatContainer, {
            childList: true,
            subtree: true
          });
        },
        
        handleNewMessage: async function(messageNode) {
          // æå–æ¶ˆæ¯æ–‡æœ¬
          const textElement = messageNode.querySelector('.selectable-text');
          if (!textElement) return;
          
          const messageText = textElement.innerText;
          const isGroupChat = this.isGroupChat();
          
          // æ£€æŸ¥æ˜¯å¦éœ€è¦ç¿»è¯‘
          if (!this.config.global.autoTranslate) return;
          if (isGroupChat && !this.config.global.groupTranslation) return;
          
          // è¯·æ±‚ç¿»è¯‘
          const result = await window.electronAPI.translate({
            text: messageText,
            sourceLang: this.config.global.sourceLang,
            targetLang: this.config.global.targetLang,
            engineName: this.config.global.engine
          });
          
          // æ˜¾ç¤ºç¿»è¯‘ç»“æœ
          this.displayTranslation(messageNode, result);
        },
        
        displayTranslation: function(messageNode, result) {
          // åˆ›å»ºç¿»è¯‘ç»“æœå…ƒç´ 
          const translationDiv = document.createElement('div');
          translationDiv.className = 'wa-translation-result';
          translationDiv.innerHTML = \`
            <div class="translation-header">
              <span class="translation-icon">ğŸŒ</span>
              <span class="translation-lang">\${result.detectedLang} â†’ \${this.config.global.targetLang}</span>
            </div>
            <div class="translation-text">\${result.translatedText}</div>
          \`;
          
          // æ’å…¥åˆ°æ¶ˆæ¯ä¸‹æ–¹
          const messageContent = messageNode.querySelector('.message-in, .message-out');
          messageContent.appendChild(translationDiv);
        },
        
        observeInputBox: function() {
          // ç›‘å¬è¾“å…¥æ¡†
          const inputBox = document.querySelector('[data-testid="conversation-compose-box-input"]');
          if (!inputBox) return;
          
          // æ·»åŠ ç¿»è¯‘æŒ‰é’®
          this.addTranslateButton();
          
          // å®æ—¶ç¿»è¯‘ç›‘å¬
          if (this.config.advanced.realtime) {
            let timeout;
            inputBox.addEventListener('input', () => {
              clearTimeout(timeout);
              timeout = setTimeout(() => {
                this.handleRealtimeTranslation(inputBox);
              }, 500);
            });
          }
        },
        
        addTranslateButton: function() {
          const composeBox = document.querySelector('[data-testid="compose-box"]');
          if (!composeBox) return;
          
          const translateBtn = document.createElement('button');
          translateBtn.className = 'wa-translate-btn';
          translateBtn.innerHTML = 'ğŸŒ';
          translateBtn.title = 'ç¿»è¯‘';
          translateBtn.onclick = () => this.translateInputBox();
          
          composeBox.appendChild(translateBtn);
        },
        
        translateInputBox: async function() {
          const inputBox = document.querySelector('[data-testid="conversation-compose-box-input"]');
          const text = inputBox.innerText;
          
          if (!text.trim()) return;
          
          // æ£€æŸ¥ç¦å‘ä¸­æ–‡
          if (this.config.advanced.blockChinese && this.containsChinese(text)) {
            alert('æ£€æµ‹åˆ°ä¸­æ–‡å†…å®¹ï¼Œè¯·å…ˆç¿»è¯‘åå†å‘é€');
            return;
          }
          
          // è¯·æ±‚ç¿»è¯‘
          const result = await window.electronAPI.translate({
            text: text,
            sourceLang: 'auto',
            targetLang: this.config.global.targetLang,
            engineName: this.config.global.engine,
            style: this.config.inputBox.style
          });
          
          // æ›¿æ¢è¾“å…¥æ¡†å†…å®¹
          inputBox.innerText = result.translatedText;
          
          // è§¦å‘è¾“å…¥äº‹ä»¶ä»¥æ›´æ–° WhatsApp çŠ¶æ€
          inputBox.dispatchEvent(new Event('input', { bubbles: true }));
        },
        
        containsChinese: function(text) {
          return /[\u4e00-\u9fa5]/.test(text);
        },
        
        isGroupChat: function() {
          return document.querySelector('[data-testid="conversation-info-header-chat-title"]')
            ?.innerText.includes('ç¾¤ç»„');
        },
        
        injectUI: function() {
          // æ³¨å…¥ç¿»è¯‘è®¾ç½®é¢æ¿
          this.injectSettingsPanel();
          // æ³¨å…¥æ ·å¼
          this.injectStyles();
        },
        
        injectSettingsPanel: function() {
          // åˆ›å»ºè®¾ç½®æŒ‰é’®å’Œé¢æ¿
          // å®ç°çœç•¥...
        },
        
        injectStyles: function() {
          const style = document.createElement('style');
          style.textContent = \`
            .wa-translation-result {
              margin-top: 8px;
              padding: 8px;
              background: rgba(0, 0, 0, 0.05);
              border-radius: 8px;
              font-size: 14px;
            }
            .translation-header {
              display: flex;
              align-items: center;
              gap: 6px;
              margin-bottom: 4px;
              font-size: 12px;
              color: #667781;
            }
            .translation-text {
              color: #111b21;
            }
            .wa-translate-btn {
              padding: 8px;
              background: transparent;
              border: none;
              cursor: pointer;
              font-size: 20px;
            }
            .wa-translate-btn:hover {
              background: rgba(0, 0, 0, 0.05);
              border-radius: 50%;
            }
          \`;
          document.head.appendChild(style);
        }
      };
      
      // ç­‰å¾… WhatsApp Web åŠ è½½å®Œæˆ
      const waitForWhatsApp = setInterval(() => {
        if (document.querySelector('[data-testid="conversation-panel-messages"]')) {
          clearInterval(waitForWhatsApp);
          window.WhatsAppTranslation.init();
        }
      }, 1000);
    })();
  `);
}
```

### 5. IPC é€šä¿¡æ¥å£

ä¸»è¿›ç¨‹å’Œæ¸²æŸ“è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡æ¥å£ã€‚

```javascript
// ä¸»è¿›ç¨‹ (main.js)
const { ipcMain } = require('electron');

// ç¿»è¯‘è¯·æ±‚
ipcMain.handle('translation:translate', async (event, request) => {
  return await translationManager.translate(
    request.text,
    request.sourceLang,
    request.targetLang,
    request.engineName,
    { style: request.style, context: request.context }
  );
});

// è·å–é…ç½®
ipcMain.handle('translation:getConfig', async (event, accountId) => {
  return translationManager.getConfig(accountId);
});

// ä¿å­˜é…ç½®
ipcMain.handle('translation:saveConfig', async (event, accountId, config) => {
  return translationManager.saveConfig(accountId, config);
});

// è¯­è¨€æ£€æµ‹
ipcMain.handle('translation:detectLanguage', async (event, text) => {
  return translationManager.detectLanguage(text);
});

// è¯­éŸ³ç¿»è¯‘
ipcMain.handle('translation:translateVoice', async (event, audioData) => {
  // 1. è¯­éŸ³è½¬æ–‡æœ¬
  const text = await voiceRecognitionService.recognize(audioData);
  // 2. ç¿»è¯‘æ–‡æœ¬
  return await translationManager.translate(text, 'auto', config.targetLang, config.engine);
});

// å›¾ç‰‡ç¿»è¯‘
ipcMain.handle('translation:translateImage', async (event, imageData) => {
  // 1. OCR è¯†åˆ«
  const text = await ocrService.recognize(imageData);
  // 2. ç¿»è¯‘æ–‡æœ¬
  return await translationManager.translate(text, 'auto', config.targetLang, config.engine);
});

// é¢„åŠ è½½è„šæœ¬ (preload.js)
const { contextBridge, ipcRenderer } = require('electron');

contextBridge.exposeInMainWorld('electronAPI', {
  translate: (request) => ipcRenderer.invoke('translation:translate', request),
  getConfig: (accountId) => ipcRenderer.invoke('translation:getConfig', accountId),
  saveConfig: (accountId, config) => ipcRenderer.invoke('translation:saveConfig', accountId, config),
  detectLanguage: (text) => ipcRenderer.invoke('translation:detectLanguage', text),
  translateVoice: (audioData) => ipcRenderer.invoke('translation:translateVoice', audioData),
  translateImage: (imageData) => ipcRenderer.invoke('translation:translateImage', imageData)
});
```


## æ•°æ®æ¨¡å‹

### 1. ç¿»è¯‘é…ç½®æ•°æ®æ¨¡å‹

```javascript
// å­˜å‚¨åœ¨ electron-store ä¸­
{
  "accounts": {
    "account_1": {
      "global": {
        "autoTranslate": true,
        "engine": "google",
        "sourceLang": "auto",
        "targetLang": "zh-CN",
        "groupTranslation": false
      },
      "inputBox": {
        "enabled": true,
        "style": "é€šç”¨"
      },
      "advanced": {
        "friendIndependent": true,
        "blockChinese": false,
        "realtime": false,
        "reverseTranslation": false,
        "voiceTranslation": true,
        "imageTranslation": true
      },
      "friendConfigs": {
        "1234567890@c.us": {
          "enabled": true,
          "targetLang": "en",
          "blockChinese": true
        }
      }
    }
  },
  "engines": {
    "google": {
      "type": "google",
      "enabled": true
    },
    "gpt4": {
      "type": "openai",
      "enabled": true,
      "apiKey": "sk-xxx",
      "model": "gpt-4",
      "endpoint": "https://api.openai.com/v1/chat/completions"
    },
    "gemini": {
      "type": "gemini",
      "enabled": true,
      "apiKey": "xxx",
      "model": "gemini-pro"
    },
    "deepseek": {
      "type": "openai",
      "enabled": true,
      "apiKey": "xxx",
      "model": "deepseek-chat",
      "endpoint": "https://api.deepseek.com/v1/chat/completions"
    },
    "custom": {
      "type": "custom",
      "enabled": false,
      "apiKey": "",
      "model": "",
      "endpoint": ""
    }
  }
}
```

### 2. ç¿»è¯‘ç¼“å­˜æ•°æ®æ¨¡å‹

```sql
-- SQLite æ•°æ®åº“ç»“æ„
CREATE TABLE translation_cache (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  cache_key TEXT UNIQUE NOT NULL,
  source_text TEXT NOT NULL,
  translated_text TEXT NOT NULL,
  source_lang TEXT NOT NULL,
  target_lang TEXT NOT NULL,
  engine TEXT NOT NULL,
  created_at INTEGER NOT NULL,
  accessed_at INTEGER NOT NULL,
  access_count INTEGER DEFAULT 1
);

CREATE INDEX idx_cache_key ON translation_cache(cache_key);
CREATE INDEX idx_created_at ON translation_cache(created_at);
```

### 3. ç¿»è¯‘ç»Ÿè®¡æ•°æ®æ¨¡å‹

```sql
CREATE TABLE translation_stats (
  id INTEGER PRIMARY KEY AUTOINCREMENT,
  account_id TEXT NOT NULL,
  date TEXT NOT NULL,
  engine TEXT NOT NULL,
  request_count INTEGER DEFAULT 0,
  success_count INTEGER DEFAULT 0,
  failure_count INTEGER DEFAULT 0,
  total_chars INTEGER DEFAULT 0,
  avg_response_time INTEGER DEFAULT 0,
  UNIQUE(account_id, date, engine)
);

CREATE INDEX idx_account_date ON translation_stats(account_id, date);
```

## é”™è¯¯å¤„ç†

### é”™è¯¯ç±»å‹å®šä¹‰

```javascript
class TranslationError extends Error {
  constructor(code, message, details = {}) {
    super(message);
    this.name = 'TranslationError';
    this.code = code;
    this.details = details;
  }
}

// é”™è¯¯ä»£ç 
const ErrorCodes = {
  NETWORK_ERROR: 'NETWORK_ERROR',
  API_KEY_INVALID: 'API_KEY_INVALID',
  RATE_LIMIT_EXCEEDED: 'RATE_LIMIT_EXCEEDED',
  UNSUPPORTED_LANGUAGE: 'UNSUPPORTED_LANGUAGE',
  TEXT_TOO_LONG: 'TEXT_TOO_LONG',
  ENGINE_NOT_AVAILABLE: 'ENGINE_NOT_AVAILABLE',
  TRANSLATION_FAILED: 'TRANSLATION_FAILED',
  OCR_FAILED: 'OCR_FAILED',
  VOICE_RECOGNITION_FAILED: 'VOICE_RECOGNITION_FAILED'
};
```

### é”™è¯¯å¤„ç†ç­–ç•¥

1. **ç½‘ç»œé”™è¯¯**: è‡ªåŠ¨é‡è¯• 3 æ¬¡ï¼Œé—´éš” 1sã€2sã€4s
2. **API å¯†é’¥é”™è¯¯**: ç«‹å³é€šçŸ¥ç”¨æˆ·ï¼Œåœæ­¢ä½¿ç”¨è¯¥å¼•æ“
3. **é€Ÿç‡é™åˆ¶**: åˆ‡æ¢åˆ°å¤‡ç”¨å¼•æ“æˆ–å»¶è¿Ÿé‡è¯•
4. **ä¸æ”¯æŒçš„è¯­è¨€**: æç¤ºç”¨æˆ·é€‰æ‹©å…¶ä»–è¯­è¨€å¯¹
5. **æ–‡æœ¬è¿‡é•¿**: è‡ªåŠ¨åˆ†æ®µç¿»è¯‘ï¼Œæœ€å¤§ 5000 å­—ç¬¦/æ®µ
6. **å¼•æ“ä¸å¯ç”¨**: è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨å¼•æ“
7. **ç¿»è¯‘å¤±è´¥**: æ˜¾ç¤ºåŸæ–‡ï¼Œè®°å½•é”™è¯¯æ—¥å¿—

### é”™è¯¯å¤„ç†å®ç°

```javascript
class TranslationManager {
  async translate(text, sourceLang, targetLang, engineName, options = {}) {
    const maxRetries = 3;
    let lastError;
    
    for (let attempt = 0; attempt < maxRetries; attempt++) {
      try {
        // æ£€æŸ¥ç¼“å­˜
        const cached = await this.cache.get(text, sourceLang, targetLang, engineName);
        if (cached) {
          return { ...cached, cached: true };
        }
        
        // è·å–å¼•æ“
        const engine = this.engines.get(engineName);
        if (!engine || !engine.isAvailable()) {
          throw new TranslationError(
            ErrorCodes.ENGINE_NOT_AVAILABLE,
            `Engine ${engineName} is not available`
          );
        }
        
        // æ‰§è¡Œç¿»è¯‘
        const result = await engine.translate(text, sourceLang, targetLang, options);
        
        // ç¼“å­˜ç»“æœ
        await this.cache.set(text, sourceLang, targetLang, engineName, result);
        
        // è®°å½•ç»Ÿè®¡
        await this.recordStats(engineName, true, text.length, Date.now() - startTime);
        
        return { ...result, cached: false };
        
      } catch (error) {
        lastError = error;
        
        // è®°å½•å¤±è´¥ç»Ÿè®¡
        await this.recordStats(engineName, false, text.length, 0);
        
        // æ ¹æ®é”™è¯¯ç±»å‹å†³å®šæ˜¯å¦é‡è¯•
        if (error.code === ErrorCodes.API_KEY_INVALID) {
          // ä¸é‡è¯•ï¼Œç›´æ¥å¤±è´¥
          break;
        }
        
        if (error.code === ErrorCodes.RATE_LIMIT_EXCEEDED) {
          // å°è¯•åˆ‡æ¢å¼•æ“
          const fallbackEngine = this.getFallbackEngine(engineName);
          if (fallbackEngine) {
            engineName = fallbackEngine;
            continue;
          }
        }
        
        // ç½‘ç»œé”™è¯¯ï¼Œç­‰å¾…åé‡è¯•
        if (attempt < maxRetries - 1) {
          await this.delay(Math.pow(2, attempt) * 1000);
        }
      }
    }
    
    // æ‰€æœ‰é‡è¯•å¤±è´¥
    throw lastError;
  }
  
  getFallbackEngine(currentEngine) {
    const fallbackOrder = ['google', 'gpt4', 'gemini', 'deepseek'];
    const currentIndex = fallbackOrder.indexOf(currentEngine);
    
    for (let i = currentIndex + 1; i < fallbackOrder.length; i++) {
      const engine = this.engines.get(fallbackOrder[i]);
      if (engine && engine.isAvailable()) {
        return fallbackOrder[i];
      }
    }
    
    return null;
  }
}
```


## æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

**æµ‹è¯•èŒƒå›´**:
- ç¿»è¯‘å¼•æ“é€‚é…å™¨
- ç¼“å­˜ç®¡ç†å™¨
- é…ç½®ç®¡ç†å™¨
- è¯­è¨€æ£€æµ‹å™¨
- é”™è¯¯å¤„ç†é€»è¾‘

**æµ‹è¯•æ¡†æ¶**: Jest

**æµ‹è¯•ç¤ºä¾‹**:

```javascript
describe('GoogleTranslateAdapter', () => {
  let adapter;
  
  beforeEach(() => {
    adapter = new GoogleTranslateAdapter({ apiKey: 'test-key' });
  });
  
  test('should translate text correctly', async () => {
    const result = await adapter.translate('Hello', 'en', 'zh-CN');
    expect(result.translatedText).toBe('ä½ å¥½');
  });
  
  test('should detect language correctly', async () => {
    const lang = await adapter.detectLanguage('Hello world');
    expect(lang).toBe('en');
  });
  
  test('should handle API errors gracefully', async () => {
    adapter.config.apiKey = 'invalid-key';
    await expect(adapter.translate('Hello', 'en', 'zh-CN'))
      .rejects.toThrow(TranslationError);
  });
});

describe('CacheManager', () => {
  let cache;
  
  beforeEach(() => {
    cache = new CacheManager(100, 1000);
  });
  
  test('should cache translation results', async () => {
    await cache.set('Hello', 'en', 'zh-CN', 'google', { translatedText: 'ä½ å¥½' });
    const result = await cache.get('Hello', 'en', 'zh-CN', 'google');
    expect(result.translatedText).toBe('ä½ å¥½');
  });
  
  test('should return null for cache miss', async () => {
    const result = await cache.get('NonExistent', 'en', 'zh-CN', 'google');
    expect(result).toBeNull();
  });
});
```

### é›†æˆæµ‹è¯•

**æµ‹è¯•èŒƒå›´**:
- ä¸»è¿›ç¨‹ä¸æ¸²æŸ“è¿›ç¨‹ IPC é€šä¿¡
- ç¿»è¯‘å¼•æ“ä¸ç¼“å­˜çš„é›†æˆ
- é…ç½®åŠ è½½ä¸ä¿å­˜
- å†…å®¹è„šæœ¬æ³¨å…¥ä¸ DOM æ“ä½œ

**æµ‹è¯•æ¡†æ¶**: Jest + Spectron (Electron æµ‹è¯•)

### ç«¯åˆ°ç«¯æµ‹è¯•

**æµ‹è¯•åœºæ™¯**:
1. ç”¨æˆ·å¯ç”¨è‡ªåŠ¨ç¿»è¯‘ï¼Œæ¥æ”¶æ¶ˆæ¯æ—¶è‡ªåŠ¨æ˜¾ç¤ºç¿»è¯‘
2. ç”¨æˆ·åœ¨è¾“å…¥æ¡†è¾“å…¥æ–‡æœ¬ï¼Œç‚¹å‡»ç¿»è¯‘æŒ‰é’®ï¼Œæ–‡æœ¬è¢«ç¿»è¯‘
3. ç”¨æˆ·ä¸ºç‰¹å®šå¥½å‹è®¾ç½®ç‹¬ç«‹ç¿»è¯‘é…ç½®
4. ç”¨æˆ·å¯ç”¨ç¦å‘ä¸­æ–‡ï¼Œå°è¯•å‘é€ä¸­æ–‡è¢«æ‹¦æˆª
5. ç”¨æˆ·å¯ç”¨å®æ—¶ç¿»è¯‘ï¼Œè¾“å…¥æ—¶æ˜¾ç¤ºå®æ—¶ç¿»è¯‘é¢„è§ˆ
6. ç”¨æˆ·æ¥æ”¶è¯­éŸ³æ¶ˆæ¯ï¼Œè‡ªåŠ¨è½¬æ–‡æœ¬å¹¶ç¿»è¯‘
7. ç”¨æˆ·æ¥æ”¶å›¾ç‰‡æ¶ˆæ¯ï¼Œè‡ªåŠ¨ OCR å¹¶ç¿»è¯‘

**æµ‹è¯•å·¥å…·**: Playwright + Electron

### æ€§èƒ½æµ‹è¯•

**æµ‹è¯•æŒ‡æ ‡**:
- ç¿»è¯‘å“åº”æ—¶é—´: < 2s (95th percentile)
- ç¼“å­˜å‘½ä¸­ç‡: > 60%
- å†…å­˜å ç”¨: < 100MB (ç¿»è¯‘æ¨¡å—)
- CPU å ç”¨: < 5% (ç©ºé—²æ—¶)

**æµ‹è¯•æ–¹æ³•**:
- ä½¿ç”¨ Lighthouse è¿›è¡Œæ€§èƒ½åˆ†æ
- ä½¿ç”¨ Chrome DevTools è¿›è¡Œå†…å­˜å’Œ CPU åˆ†æ
- æ¨¡æ‹Ÿå¤§é‡ç¿»è¯‘è¯·æ±‚è¿›è¡Œå‹åŠ›æµ‹è¯•

### å…¼å®¹æ€§æµ‹è¯•

**æµ‹è¯•å¹³å°**:
- Windows 10/11
- macOS 12+
- Linux (Ubuntu 20.04+)

**æµ‹è¯•æµè§ˆå™¨å†…æ ¸**:
- Chromium (Electron å†…ç½®)

**æµ‹è¯• WhatsApp Web ç‰ˆæœ¬**:
- å½“å‰ç¨³å®šç‰ˆ
- Beta ç‰ˆ (å¦‚æœ‰)

## æ€§èƒ½ä¼˜åŒ–

### 1. ç¿»è¯‘ç¼“å­˜ç­–ç•¥

- **LRU ç¼“å­˜**: å†…å­˜ä¸­ä¿ç•™æœ€è¿‘ 1000 æ¡ç¿»è¯‘ç»“æœ
- **æŒä¹…åŒ–ç¼“å­˜**: SQLite å­˜å‚¨æ‰€æœ‰ç¿»è¯‘å†å²ï¼Œ7 å¤©è¿‡æœŸ
- **ç¼“å­˜é¢„çƒ­**: åº”ç”¨å¯åŠ¨æ—¶åŠ è½½å¸¸ç”¨ç¿»è¯‘å¯¹
- **æ‰¹é‡ç¿»è¯‘**: åˆå¹¶å¤šä¸ªçŸ­æ–‡æœ¬ä¸ºä¸€æ¬¡è¯·æ±‚

### 2. DOM æ“ä½œä¼˜åŒ–

- **è™šæ‹Ÿæ»šåŠ¨**: åªæ¸²æŸ“å¯è§åŒºåŸŸçš„ç¿»è¯‘ç»“æœ
- **é˜²æŠ–å¤„ç†**: å®æ—¶ç¿»è¯‘ä½¿ç”¨ 500ms é˜²æŠ–
- **æ‰¹é‡æ›´æ–°**: ä½¿ç”¨ requestAnimationFrame æ‰¹é‡æ›´æ–° DOM
- **äº‹ä»¶å§”æ‰˜**: ä½¿ç”¨äº‹ä»¶å§”æ‰˜å‡å°‘äº‹ä»¶ç›‘å¬å™¨æ•°é‡

### 3. ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

- **è¯·æ±‚é˜Ÿåˆ—**: é™åˆ¶å¹¶å‘ç¿»è¯‘è¯·æ±‚æ•°é‡ (æœ€å¤š 5 ä¸ª)
- **è¯·æ±‚åˆå¹¶**: ç›¸åŒæ–‡æœ¬çš„é‡å¤è¯·æ±‚åˆå¹¶ä¸ºä¸€æ¬¡
- **è¶…æ—¶æ§åˆ¶**: ç¿»è¯‘è¯·æ±‚è¶…æ—¶æ—¶é—´ 10s
- **è¿æ¥å¤ç”¨**: ä½¿ç”¨ HTTP/2 æˆ– keep-alive

### 4. å†…å­˜ç®¡ç†

- **å®šæœŸæ¸…ç†**: æ¯å°æ—¶æ¸…ç†è¿‡æœŸç¼“å­˜
- **å†…å­˜é™åˆ¶**: ç¼“å­˜æ€»å¤§å°ä¸è¶…è¿‡ 50MB
- **æ‡’åŠ è½½**: ç¿»è¯‘å¼•æ“æŒ‰éœ€åŠ è½½
- **èµ„æºé‡Šæ”¾**: åŠæ—¶é‡Šæ”¾ä¸å†ä½¿ç”¨çš„èµ„æº

## å®‰å…¨è€ƒè™‘

### 1. API å¯†é’¥ä¿æŠ¤

- ä½¿ç”¨ Electron safeStorage åŠ å¯†å­˜å‚¨ API å¯†é’¥
- ä¸åœ¨æ—¥å¿—ä¸­è®°å½•å®Œæ•´çš„ API å¯†é’¥
- æ”¯æŒç¯å¢ƒå˜é‡é…ç½® API å¯†é’¥

```javascript
const { safeStorage } = require('electron');

class SecureStorage {
  encryptApiKey(apiKey) {
    if (safeStorage.isEncryptionAvailable()) {
      return safeStorage.encryptString(apiKey).toString('base64');
    }
    return apiKey; // é™çº§æ–¹æ¡ˆ
  }
  
  decryptApiKey(encrypted) {
    if (safeStorage.isEncryptionAvailable()) {
      const buffer = Buffer.from(encrypted, 'base64');
      return safeStorage.decryptString(buffer);
    }
    return encrypted;
  }
}
```

### 2. æ•°æ®éšç§

- ç¿»è¯‘å†…å®¹ä¸ä¸Šä¼ åˆ°ç¬¬ä¸‰æ–¹æœåŠ¡å™¨ï¼ˆé™¤ç¿»è¯‘ APIï¼‰
- ç¼“å­˜æ•°æ®æœ¬åœ°å­˜å‚¨ï¼Œä¸åŒæ­¥åˆ°äº‘ç«¯
- æ”¯æŒç”¨æˆ·æ‰‹åŠ¨æ¸…é™¤æ‰€æœ‰ç¿»è¯‘å†å²
- éµå®ˆ GDPR å’Œå…¶ä»–éšç§æ³•è§„

### 3. å†…å®¹å®‰å…¨

- å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œ XSS è¿‡æ»¤
- ç¿»è¯‘ç»“æœè¿›è¡Œ HTML è½¬ä¹‰
- é˜²æ­¢ SQL æ³¨å…¥ï¼ˆä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼‰
- é™åˆ¶ç¿»è¯‘æ–‡æœ¬é•¿åº¦ï¼ˆæœ€å¤§ 10000 å­—ç¬¦ï¼‰

### 4. ç½‘ç»œå®‰å…¨

- æ‰€æœ‰ API è¯·æ±‚ä½¿ç”¨ HTTPS
- éªŒè¯ SSL è¯ä¹¦
- å®ç°è¯·æ±‚ç­¾åé˜²æ­¢ç¯¡æ”¹
- è®¾ç½®åˆç†çš„è¶…æ—¶æ—¶é—´é˜²æ­¢ DoS

## éƒ¨ç½²å’Œé…ç½®

### 1. é…ç½®æ–‡ä»¶ç»“æ„

```
.kiro/
â””â”€â”€ translation/
    â”œâ”€â”€ config.json          # ç¿»è¯‘é…ç½®
    â”œâ”€â”€ cache.db             # ç¿»è¯‘ç¼“å­˜æ•°æ®åº“
    â””â”€â”€ stats.db             # ç»Ÿè®¡æ•°æ®åº“
```

### 2. ç¯å¢ƒå˜é‡

```bash
# Google Translate API
GOOGLE_TRANSLATE_API_KEY=xxx

# OpenAI API
OPENAI_API_KEY=sk-xxx
OPENAI_API_ENDPOINT=https://api.openai.com/v1/chat/completions

# Gemini API
GEMINI_API_KEY=xxx

# DeepSeek API
DEEPSEEK_API_KEY=xxx
DEEPSEEK_API_ENDPOINT=https://api.deepseek.com/v1/chat/completions

# ç¼“å­˜é…ç½®
TRANSLATION_CACHE_SIZE=1000
TRANSLATION_CACHE_TTL=604800000  # 7 days in ms

# æ—¥å¿—çº§åˆ«
TRANSLATION_LOG_LEVEL=info
```

### 3. åˆå§‹åŒ–æµç¨‹

1. åº”ç”¨å¯åŠ¨æ—¶åŠ è½½ç¿»è¯‘é…ç½®
2. åˆå§‹åŒ–ç¿»è¯‘å¼•æ“ï¼ˆæ ¹æ®é…ç½®ï¼‰
3. è¿æ¥ç¼“å­˜æ•°æ®åº“
4. æ³¨å…¥å†…å®¹è„šæœ¬åˆ° WhatsApp Web
5. å»ºç«‹ IPC é€šä¿¡é€šé“
6. å¼€å§‹ç›‘å¬æ¶ˆæ¯å’Œç”¨æˆ·æ“ä½œ

### 4. æ›´æ–°å’Œç»´æŠ¤

- æ”¯æŒçƒ­æ›´æ–°ç¿»è¯‘å¼•æ“é…ç½®
- å®šæœŸæ£€æŸ¥ç¿»è¯‘ API å¯ç”¨æ€§
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸç¼“å­˜å’Œæ—¥å¿—
- æä¾›é…ç½®å¯¼å…¥å¯¼å‡ºåŠŸèƒ½

## æ‰©å±•æ€§è®¾è®¡

### 1. æ’ä»¶åŒ–ç¿»è¯‘å¼•æ“

æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ç¿»è¯‘å¼•æ“æ’ä»¶ï¼š

```javascript
// æ’ä»¶æ¥å£
class TranslationPlugin {
  constructor(config) {
    this.name = config.name;
    this.version = config.version;
  }
  
  async translate(text, sourceLang, targetLang, options) {
    // æ’ä»¶å®ç°
  }
  
  async detectLanguage(text) {
    // æ’ä»¶å®ç°
  }
}

// æ’ä»¶æ³¨å†Œ
translationManager.registerPlugin(new CustomTranslationPlugin({
  name: 'MyTranslator',
  version: '1.0.0',
  apiEndpoint: 'https://my-api.com/translate'
}));
```

### 2. å¤šå¹³å°æ”¯æŒ

è®¾è®¡æ”¯æŒæ‰©å±•åˆ°å…¶ä»–èŠå¤©å¹³å°ï¼š

- Telegram
- Facebook Messenger
- WeChat (å¦‚æœå¯è¡Œ)

### 3. ç¿»è¯‘å†å²å’Œå­¦ä¹ 

- è®°å½•ç”¨æˆ·çš„ç¿»è¯‘åå¥½
- åŸºäºå†å²ä¼˜åŒ–ç¿»è¯‘è´¨é‡
- æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰æœ¯è¯­è¡¨

### 4. åä½œç¿»è¯‘

- æ”¯æŒå›¢é˜Ÿå…±äº«ç¿»è¯‘é…ç½®
- ç»Ÿä¸€çš„æœ¯è¯­åº“ç®¡ç†
- ç¿»è¯‘è´¨é‡è¯„åˆ†å’Œåé¦ˆ
