# WhatsApp Desktop - 测试文档总览

本目录包含 WhatsApp Desktop 应用的完整测试文档和工具。

## 📚 测试文档

### 1. [TESTING_GUIDE.md](TESTING_GUIDE.md)
**详细的测试指南**

包含完整的测试步骤、预期结果和验证清单，涵盖：
- 8.1 测试基本功能
- 8.2 测试会话持久化
- 8.3 测试错误场景

每个测试项都包含：
- 详细的操作步骤
- 预期结果
- 验证清单
- 常见问题排查

### 2. [TEST_CHECKLIST.md](TEST_CHECKLIST.md)
**测试检查清单**

可打印的测试清单，用于跟踪测试进度：
- 勾选框格式，便于标记完成状态
- 问题记录区域
- 测试结果汇总
- 测试环境信息记录

## 🛠️ 测试工具

### 可用的测试脚本

| 脚本命令 | 说明 | 用途 |
|---------|------|------|
| `npm run test:setup` | 测试环境检查 | 验证 Node.js、依赖、文件等是否正确配置 |
| `npm run test:session` | 会话数据检查 | 检查会话数据是否存在、大小、有效性 |
| `npm run test:reconnect` | 重连配置检查 | 验证重连配置和逻辑是否正确实现 |
| `npm run test:clean` | 清理会话数据 | 删除保存的会话数据，用于重新测试登录 |

### 脚本详细说明

#### 1. test:setup - 测试环境检查
```bash
npm run test:setup
```

**检查项目：**
- ✓ Node.js 版本（需要 18+）
- ✓ npm 版本
- ✓ package.json 存在
- ✓ node_modules 目录存在
- ✓ 关键依赖已安装（electron, whatsapp-web.js）
- ✓ 源代码文件存在（main.js, config.js）
- ✓ 会话数据目录状态
- ✓ 资源文件存在
- ✓ 测试文档存在

**使用场景：**
- 开始测试前验证环境
- 排查环境配置问题
- 新团队成员设置环境

#### 2. test:session - 会话数据检查
```bash
npm run test:session
```

**检查项目：**
- ✓ session-data 目录是否存在
- ✓ .wwebjs_auth 目录是否存在
- ✓ 会话文件数量和大小
- ✓ 会话文件列表
- ✓ 会话最后修改时间
- ✓ 会话有效性评估

**使用场景：**
- 测试会话持久化功能
- 验证会话数据是否正确保存
- 检查会话是否可能过期

#### 3. test:reconnect - 重连配置检查
```bash
npm run test:reconnect
```

**检查项目：**
- ✓ 重连配置是否存在
- ✓ 重连是否启用
- ✓ 重连延迟设置
- ✓ 最大尝试次数
- ✓ 总等待时间计算
- ✓ 重连逻辑实现验证

**使用场景：**
- 测试错误场景前验证配置
- 调整重连参数后验证
- 排查重连功能问题

#### 4. test:clean - 清理会话数据
```bash
npm run test:clean
```

**功能：**
- 删除 session-data 目录及其所有内容
- 清理所有保存的会话数据

**使用场景：**
- 重新测试首次登录流程
- 测试二维码显示功能
- 清理测试数据

**⚠️ 警告：** 此操作不可逆，执行后需要重新扫码登录

## 🚀 快速开始测试

### 第一次测试

1. **验证环境**
```bash
npm run test:setup
```

2. **清理会话数据（如果需要）**
```bash
npm run test:clean
```

3. **打开测试清单**
打开 `TEST_CHECKLIST.md` 文件

4. **启动应用**
```bash
npm start
```

5. **按照清单逐项测试**
参考 `TESTING_GUIDE.md` 中的详细步骤

### 测试会话持久化

1. **检查当前会话状态**
```bash
npm run test:session
```

2. **启动应用**
```bash
npm start
```

3. **验证自动登录**
应用应该直接显示聊天界面，无需扫码

### 测试重连功能

1. **验证重连配置**
```bash
npm run test:reconnect
```

2. **启动应用并登录**
```bash
npm start
```

3. **断开网络连接**
- Windows: 禁用网络适配器
- Linux/macOS: 关闭 WiFi

4. **观察控制台输出**
应该看到重连尝试的日志

5. **恢复网络连接**
验证应用自动重连

## 📋 测试流程

```
┌─────────────────────────────────────────────────────────┐
│                    开始测试                              │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  1. 运行 npm run test:setup                             │
│     验证测试环境                                         │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  2. 打开 TEST_CHECKLIST.md                              │
│     准备记录测试结果                                     │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  3. 测试基本功能 (8.1)                                   │
│     - 启动应用                                           │
│     - 验证窗口显示                                       │
│     - 扫码登录                                           │
│     - 测试消息收发                                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  4. 测试会话持久化 (8.2)                                 │
│     - 运行 npm run test:session                         │
│     - 重启应用                                           │
│     - 验证自动登录                                       │
│     - 测试会话过期                                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  5. 测试错误场景 (8.3)                                   │
│     - 运行 npm run test:reconnect                       │
│     - 测试网络断开                                       │
│     - 测试应用崩溃恢复                                   │
│     - 验证日志输出                                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│  6. 填写测试结果                                         │
│     - 记录问题                                           │
│     - 提出改进建议                                       │
│     - 完成测试报告                                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────┐
│                    测试完成                              │
└─────────────────────────────────────────────────────────┘
```

## 📊 测试覆盖范围

### 功能测试
- ✅ 应用启动和窗口显示
- ✅ WhatsApp Web 页面加载
- ✅ 二维码显示和扫码登录
- ✅ 消息收发功能
- ✅ 会话持久化
- ✅ 自动登录
- ✅ 会话过期处理

### 错误场景测试
- ✅ 网络断开和重连
- ✅ 应用崩溃恢复
- ✅ 错误日志输出
- ✅ 重连次数限制

### 非功能测试
- ✅ 日志格式和内容
- ✅ 会话数据完整性
- ✅ 配置正确性

## 🐛 常见问题

### 问题：测试脚本无法运行

**解决方案：**
```bash
# 确保有执行权限（Linux/macOS）
chmod +x scripts/*.js

# 或直接使用 node 运行
node scripts/test-setup.js
```

### 问题：会话数据检查显示为空

**原因：** 尚未完成首次登录

**解决方案：**
1. 启动应用：`npm start`
2. 扫码登录
3. 关闭应用
4. 再次运行：`npm run test:session`

### 问题：测试环境检查失败

**解决方案：**
1. 检查 Node.js 版本：`node --version`（需要 18+）
2. 重新安装依赖：`npm install`
3. 查看具体错误信息

## 📝 测试报告模板

测试完成后，可以使用以下模板生成测试报告：

```markdown
# WhatsApp Desktop 测试报告

## 测试信息
- 测试日期：YYYY-MM-DD
- 测试人员：[姓名]
- 应用版本：1.0.0
- 测试环境：[操作系统]

## 测试结果汇总
- 8.1 测试基本功能：✅ 通过 / ❌ 失败
- 8.2 测试会话持久化：✅ 通过 / ❌ 失败
- 8.3 测试错误场景：✅ 通过 / ❌ 失败

## 发现的问题
1. [问题描述]
   - 严重程度：高/中/低
   - 复现步骤：...
   - 预期结果：...
   - 实际结果：...

## 改进建议
1. [建议内容]

## 测试结论
[总体评价]
```

## 🔗 相关文档

- [README.md](README.md) - 项目说明
- [USAGE.md](USAGE.md) - 使用说明
- [LAUNCH_INSTRUCTIONS.md](LAUNCH_INSTRUCTIONS.md) - 启动说明
- [PROJECT_STATUS.md](PROJECT_STATUS.md) - 项目状态

## 📞 支持

如果在测试过程中遇到问题：
1. 查看 [TESTING_GUIDE.md](TESTING_GUIDE.md) 中的常见问题排查
2. 检查控制台错误日志
3. 运行相关测试脚本诊断问题

---

**最后更新：** 2025-11-10
